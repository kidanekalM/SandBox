<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title> Escrow Test | Chapa Checkout</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 600px;
      margin: 20px auto;
      padding: 0 15px;
      background: #f8f9fa;
      color: #333;
    }
    .container { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h1 { color: #2c3e50; text-align: center; }
    .logo { text-align: center; margin-bottom: 20px; }
    .logo span { font-size: 24px; font-weight: bold; color: #e74c3c; }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; font-weight: 600; }
    input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; }
    button {
      width: 100%; background: #e74c3c; color: white; border: none; padding: 14px;
      font-size: 18px; border-radius: 6px; cursor: pointer; margin-top: 10px;
    }
    button:hover { background: #c0392b; }
    .info-box {
      background: #e3f2fd; border-left: 4px solid #2196f3; padding: 15px; margin: 20px 0;
      font-size: 14px;
    }
    .amharic-toggle {
      text-align: center; margin-bottom: 15px;
    }
    .amharic-toggle button {
      background: #3498db; width: auto; font-size: 14px;
    }
    .footer { text-align: center; margin-top: 25px; color: #7f8c8d; font-size: 14px; }
    .highlight { background: #fff8e1; padding: 3px 6px; border-radius: 3px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">
      <span></span> ‚Ä¢ Escrow Payment Test
    </div>

    <div class="amharic-toggle">
      <button onclick="alert('Amharic version coming soon!')">·ä†·àõ·à≠·äõ</button>
    </div>

    <h2>	escrow Payment</h2>
    
    <div class="info-box">
      üîí <strong>Secure & Non-Custodial</strong><br>
      Funds are held by <span class="highlight">Chapa</span> via EthioPay pre-authorization.<br>
      Released only when  confirms milestone completion.
    </div>

    <div class="form-group">
      <label for="amount">Amount (ETB)</label>
      <input type="number" id="amount" value="1000" min="10" step="100">
    </div>

    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" id="email" value="test@example.et" placeholder="you@example.et">
    </div>

    <div class="form-group">
      <label for="phone">Phone (09XXXXXXXX)</label>
      <input type="tel" id="phone" value="0912345678" placeholder="0912345678">
    </div>

    <div class="form-group">
      <label for="ref">Escrow Reference</label>
      <input type="text" id="ref" value="ESCROW-HAF-TEST-001" readonly>
      <small>Auto-generated for testing</small>
    </div>

    <div class="form-group">
      <label>Payment Method</label><br>
      <input type="radio" id="telebirr" name="method" value="telebirr" checked>
      <label for="telebirr" style="display:inline; margin-right:15px">üì± TeleBirr</label>
      
      <input type="radio" id="ethiopay" name="method" value="ethiopay">
      <label for="ethiopay" style="display:inline; margin-right:15px">üí≥ EthioPay Card</label>
      
      <input type="radio" id="bank" name="method" value="bank_collection">
      <label for="bank" style="display:inline">üè¶ Bank Transfer</label>
    </div>

    <button onclick="initCheckout()">‚úÖ Pay & Hold Funds (Pre-Auth)</button>

    <div class="info-box">
      <strong>How it works:</strong><br>
      1. You pay ‚Üí funds are <span class="highlight">held (not transferred)</span><br>
      2.  inspects site ‚Üí approves in dashboard<br>
      3. Funds released to contractor<br>
      <em>No risk ‚Äî void anytime before approval.</em>
    </div>

    <div class="footer">
      <p>Powered by <strong>Chapa</strong> ‚Ä¢ Sandbox Mode<br>
      üîë Test Cards: <code>4000 0000 0000 0002</code> (EthioPay)<br>
      OTP: <code>123456</code></p>
    </div>
  </div>

  <script>
    // Chapa sandbox public key (safe to expose)
    const CHAPA_PUBLIC_KEY = "CHAPUBK_TEST-Eb40mkJtp3wNWXGQeeA0fZ8WXeyIWql4"; // ‚Üê REPLACE with your Chapa test key

    function initCheckout() {
      const amount = document.getElementById('amount').value;
      const email = document.getElementById('email').value;
      const phone = document.getElementById('phone').value;
      const txRef = document.getElementById('ref').value;
      const method = document.querySelector('input[name="method"]:checked').value;

      if (!amount || !email || !phone) {
        alert("Please fill all fields");
        return;
      }

      // Build payload
      const payload = {
        key: CHAPA_PUBLIC_KEY,
        email: email,
        amount: amount,
        first_name: "Test",
        last_name: "User",
        tx_ref: txRef,
        currency: "ETB",
        callback_url: "https://example.et/success", // ‚Üê change to your success page
        return_url: "https://example.et/return",   // ‚Üê change to your return page
        customization: {
          title: " Escrow Hold",
          description: "Funds held until milestone approval"
        }
      };

      // Add payment method
      if (method === 'ethiopay') {
        payload.payment_options = "ethiopay";
        payload.authorization = {
          type: "pre_auth",
          validity_days: 14
        };
      } else if (method === 'bank_collection') {
        payload.payment_method = "bank_collection";
      } else {
        payload.payment_options = "telebirr";
      }

      // Initialize Chapa checkout
      $.ajax({
        url: "https://api.chapa.co/v1/transaction/initialize",
        method: "POST",
        headers: { "Content-Type": "application/json" },
        data: JSON.stringify(payload),
        success: function(response) {
          if (response.data && response.data.checkout_url) {
            window.location = response.data.checkout_url;
          } else {
            alert("Checkout failed: " + JSON.stringify(response));
          }
        },
        error: function(xhr) {
          alert("Error: " + xhr.responseText);
        }
      });
    }
  </script>
</body>
</html>